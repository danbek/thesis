\chapter{Sub-array Characterization}\label{c:det-array}

The detectors in the first 251-detector sub-array have not all been characterized to the same extent.
Partly this is due to manpower and time constraints.
Additionally, as described in \sectionref{sec:g-psat}, the saturation power of the detectors is \abt{2} times higher than expected, which means that only some detectors can be driven into the normal state using bias current alone --- even under optical load --- and then only at bath temperatures very close to $T_c$.
In particular, none of the detectors can be driven normal at the operating bath temperature of \SI{1100}{\mK}.
This means that we do not have current-vs-voltage (\IV) curves for any detectors at standard operating conditions, which limits the characterization than can be performed.

Seven detectors used in taking images have working heaters and no other problems.
Once calibrated, these heaters allow us to take full \IV\ curves at all bath temperatures, allowing measurements of the detector thermal conductance $G$, critical temperature $T_c$ and power-flow index $n$.
The heaters also allow a direct measurement of detector responsivity and time constants, and thus allow a measurement of detector noise referred to optical power absorbed on the detector.
These latter measurements have been carried out on four of the seven detectors.
Additionally, \Loop, $\beta_I$ and $R$ at standard operating conditions have been measured for all working detectors.
This chapter describes all these measurements, as well as measurements of shunt resistors and inductors for all detectors.
\tableref{tab:measurements} summarizes all of the measurements described in this chapter.
Sections discussing common mode noise, microphonic pickup and noise aliasing are also included.

Several measurements are taken at ``standard operating conditions'' (\SOC), which are the conditions under which the array is operated while acquiring video images.
These conditions are bath temperature $T_b = \SI{1100}{\mK}$ and detector bias $\mbox{\DAC} = \num{27000}$\footnote{The detector bias lines are controlled by digital-to-analog converter (\DAC) units as described in \sectionref{sec:det-readout}. Bias values in this chapter are in terms of \DAC\ units, where $\mbox{\DAC} = 2^{15} = 32768$ is the maximum bias that can be applied, and corresponds to $I_b \approx \SI{10}{\mA}$}.

When referring to individual detectors, I use the notation R$n$C$m$.
This notation refers to the detector read out on row $n$ of column $m$, where the indices are zero-based.

\begin{table*}[t]
\centering
\caption{Summary of measurements made on first 251-detector sub-array}
\label{tab:measurements}
\begin{tabular}{p{2.5in} l p{2.5in}}
\toprule
Measurement &  Section & Detectors Subset  \\
  \midrule
$R_{sh}$ and $L_{ny}$ & \ref{sec:shunt-nyquist} & All working detectors \\
Heater Resistors & \ref{sec:heater-r} & Seven detectors with working heaters on column 0 and 1 \\
$\tau$ & \ref{sec:tau-nat} & Four detectors with working heaters on column 0 \\
$G$, $T_c$, $n$, $P_{sat}$ & \ref{sec:g-psat} & Seven detectors with working heaters on column 0 and 1 \\
$\tau_{eff}$ and \DC\ responsivity & \ref{sec:teff-resp} & Seven detectors with working heaters on column 0 and 1 \\
\Loop, $\beta_I$, $R$ at a range of bias points & \ref{sec:bias-step} & Seven detectors with working heaters on column 0 and 1 \\
\Loop, $\beta_I$, $R$ at \SOC\ & \ref{sec:bias-step} & All working detectors\\
Detector noise at a range of bias points & \ref{sec:det-noise} & Four detectors with working heaters on column 0 and 1 \\
\bottomrule
\end{tabular}
\end{table*}

\section{Shunt Resistance Measurements}\label{sec:shunt-nyquist}

%
% All data from thesis/ana_rsh()
%

Our shunt resistors are located on interface chips that contain both shunt resistors and Nyquist inductors.
The design resistance of the shunts was \SI{180}{\uOhm}, and the design inductance was \SI{609}{\nH}.
Each chips contains 32 shunt resistors and 32 inductors.

To measure $R_{sh}$ and $L$ for these chips I took noise measurements using zero detector bias current at two different bath temperatures: 980~mK and 1160~mK.
At these bath temperatures and at zero detector bias the detectors are superconducting, so that measured noise is due to the shunt resistor, any parasitic resistance, and SQUID noise in the multiplexed readout system itself.
Data was collected at 3030.3~Hz, and 20 data acquisitions lasting 33 seconds were taken at each bath temperature.

A power spectrum was estimated for each detector for each data acquisition using \MATLAB's \texttt{pwelch} function, using a \FFT\ size of $2^{12}$.
Each resulting power spectrum was fit to a function of the form
\begin{eqnarray}\label{eqn:scnoise-fit}
	\frac{4 k_B T_b}{R_{sh}} \frac{1}{1 + (2 \pi f (L/R_{sh}))^2} + SQ,
\end{eqnarray}
where $k_B$ is Boltzmann's constant, $T_b$ is the bath temperature for the measurement, and $f$ is the frequency.
The shunt resistance $R_{sh}$, inductance $L$, and readout chain white noise level $SQ$ are the fit parameters.

\figref{fig:rsh-l-plots} shows histogram plots of the resulting \Rsh\ and $L$ values.
\Rsh\ has a mean of \SI{149}{\uOhm} with standard deviation \SI{6}{\uOhm}.
The values for \Rsh\ include any parasitic resistance in the circuit, but no evidence for significant parasitic resistance has ever been seen, so this parasitic resistance is assumed to be zero throughout this dissertation.

The value for $L$ includes the Nyquist inductance on the interface chip, the input inductance of the first-stage \SQUID\ of the multiplexed readout system, as well as any parasitic inductance in the circuit.
Using this approach it is not possible to extract the inductance of the Nyquist inductor itself, but this is not a problem because the total inductance is the relevant  quantity for understanding the behavior of the detector and its circuit.

$L$ has a mean of 568~nH with a standard deviation of 86~nH.
However, this mean includes two sets of clear outliers: all values for multiplexing row 4 are clustered around 200~nH, and all values for multiplexing row 25 are clustered around 440~nH.
The reason for these low inductances is not understood.
Excluding rows 4 and 25,  $L$ has a mean of 587~nH with a standard deviation of 44~nH.

The outlier $L$ values are more clearly visible in the lower left plot in \figref{fig:rsh-l-plots}, which also shows a small correlation between \Rsh\ and $L$.
It is not known whether this correlation is a real physical effect or an artifact of the measurement and curve fitting process.

\begin{figure*}
\includegraphics{drawings/ch6-rsh-l-plots.pdf}
\caption[Measurements of shunt resistors and Nyquist inductors]{
Plots summarizing results of measurements of shunts and Nyquist inductors.
\textbf{Upper Left} Histogram of shunt resistance \Rsh.
\textbf{Upper Right} Histogram of total inductance in circuit, which includes the interface chip Nyquist inductor, the inductance of the SQ1 input coil, and any parasitic inductance.
\textbf{Lower Left} Scatter plot showing all \Rsh\ and $L$ values. A correlation is apparent, the reason for which is not understood.
\textbf{Lower Right} Plot showing current noise power spectrum for a single data acquisition for \RCm{20}{6}, along with predicted power spectrum based on best fit to \eqnref{eqn:scnoise-fit} across all data acquisitions. The best fit values are $\Rsh=\SI{155}{\uOhm}$, $L = \SI{616}{nH}$, and \SQUID\ white noise level of \Inoise{1.2e-10}.}
\label{fig:rsh-l-plots}
\end{figure*}

\section{Measurement of Heater Resistors} \label{sec:heater-r}

Thirty-one detectors have heater resistors.
Twenty-three of these have the heater wire bonded to the heater bias line.
Of these 23, there are nine detectors which show no response to applied heater power.
Five of these nine are on the cut list (see \sectionref{sec:ch7-det-cuts}), so this is not surprising.
But four detectors can be biased into the transition and work well, but show no response to applied heater power (\RC{4}{7}, \RC{5}{7}, \RC{6}{6}, \RC{7}{6}).
The reasons for these detectors not showing a response to heater power are not fully understood.
This leaves 14 working detectors that show a response to applied heater power.

However, a short between one of the \TES\ bias lines and the heater bias line means that ramping the current bias for columns 6 and 7 also ramps the heater bias for all detectors.
This means that for the seven working heaters on columns 6 and 7, interpreting \IV\ curves is difficult because a different amount of heater power is applied at each detector bias value.
This means that for these seven detectors it is not possible to measure $G$ or to calibrate the power being applied by the resistors.

This leaves seven detectors on columns 0 and 1 with heaters for which good \IV\ curves can be taken, and $G$ measured.
The heaters on these seven detectors can be used to directly measure the detector responsivity, noise referred to input optical power, time constants and thermal conductance $G$.
But these measurements require knowing the heater resistance.

Following the procedure outlined in \sectionref{sec:ch3-iv-curve}, I took \IV\ curves at $T_b = \SI{1100}{\mK}$ using a range of heater biases.
\figref{fig:ch6-heater-r-plots} shows the results for \RCm{29}{1}.
The upper left plot shows the \TES\ \IV\ curves.
The upper right plot shows the same data, but transformed into \TES\ Joule power and \TES\ resistance.
As applied heater current decreases, the Joule power at the start of the transition decreases.
In the lower left, the Joule power at $0.99R_{n}$ is plotted vs applied heater current.
A fit to \eqnref{eqn:ch3-ptot-99Rn} is also plotted.
Finally, the lower right plot shows the $R$ vs $P_J$ plots after the heater power has been added to each curve.
This plot shows that the powers are equalized very high in the transition, where Joule power depends only on \TES\ resistance.
It also shows that this assumption breaks down deeper in the transition.

\begin{figure*}
\includegraphics{drawings/ch6-heater-r-plots.pdf}
\caption[Plots related to heater measurements]{
Plots related to heater measurements, for the case of \RCm{29}{1}.
\textbf{Upper Left} \IV\ curves. The \IV\ curves should turn vertical when the detector becomes fully superconducting at zero voltage, but these curves shown a non-infinite slope. The reason for this is that the readout system as configured for these \IV\ curves was unable keep up with the rapid change of current in the superconducting branch.
\textbf{Upper Right} Same data as in upper left plot, but represented in terms of \TES\ Joule power and resistance. As the bias current for the heaters is increased, the curves shift to the left.
\textbf{Lower Left} Measured $P_{J}$ vs heater current at $0.99R_n$, as well as the fit to \eqnref{eqn:ch3-ptot-99Rn}.
\textbf{Lower Right} Same plot as upper right, but the heater power based on $R_{htr} = \SI{23.6}{\ohm}$ has been added to each curve.
}
\label{fig:ch6-heater-r-plots}
\end{figure*}

\tableref{tab:basic-det-props} lists all measured heater resistors.
The seven heaters for columns 0 and 1 have a mean of \SI{23.1}{\ohm} with a standard deviation of \SI{1.2}{\ohm}.

\begin{table*}[t]
\centering
\caption[Measured detector properties]{
Measured detector properties.
$P_{opt} = \SI{150}{\pW}$ is assumed everywhere.
Uncertainties are 95 \% confidence intervals after marginalizing over other fit parameters, and do not include systematic uncertainties due to the unknown value of $P_{opt}$, uncertainty in the value of the shunt resistors, or possible errors in the calibration of the focal plane thermometer.
The value of $C$ is calculated using $C = \tau G$.
}
\label{tab:basic-det-props}
\begin{tabular}{c c c c c c c c}
\toprule
  Detector 
& \specialcell{$R_{htr}$ \\ (\si{\ohm})}
& \specialcell{$G$ \\ (\si{\nano\W\per\K})}
& $n$
& \specialcell{$T_c$ \\ (\si{\mK})} 
& \specialcell{$\tau$ \\ (\si{\ms})}
& \specialcell{$R_n$ \\ (\si{\mOhm})}
& \specialcell{$C$ \\ (\si{\pJ\per\K})} \\
\midrule
\RCm{29}{1} & 23.9 & 7.78 $\pm$ 0.08 & 3.55 $\pm$ 0.10 & 1209.0 $\pm$ 0.6 & 8.94 $\pm$ 0.1 & 4.39 & 70 $\pm$ 1.1 \\
\RCm{30}{1} & 23.5 & 7.73 $\pm$ 0.07 & 3.57 $\pm$ 0.09 & 1213.8 $\pm$ 0.6 & 8.82 $\pm$ 0.2 & 4.35 & 68 $\pm$ 1.4 \\
\RCm{31}{1} & 23.4 & 7.56 $\pm$ 0.10 & 3.67 $\pm$ 0.13 & 1215.4 $\pm$ 0.8 & 9.45 $\pm$ 0.1 & 4.32 & 71 $\pm$ 1.1 \\
\RCm{32}{1} & 23.0 & 6.89 $\pm$ 0.36 & 3.35 $\pm$ 0.50 & 1212.4 $\pm$ 3.2 & 10.22 $\pm$ 0.1 & 4.28 & 70 $\pm$ 3.7 \\
\RCm{29}{2} & 23.8 & 7.71 $\pm$ 0.08 & 3.58 $\pm$ 0.10 & 1213.6 $\pm$ 0.7 & 9.01 $\pm$ 0.1 & 4.36 & 69 $\pm$ 1.1 \\
\RCm{31}{2} & 20.4 & 6.35 $\pm$ 0.16 & 3.41 $\pm$ 0.24 & 1214.5 $\pm$ 1.6 & 9.51 $\pm$ 0.1 & 3.78 & 60 $\pm$ 1.6 \\
\RCm{32}{2} & 23.5 & 7.41 $\pm$ 0.25 & 3.70 $\pm$ 0.32 & 1215.8 $\pm$ 2.1 & 10.98 $\pm$ 0.1 & 4.38 & 81 $\pm$ 2.7 \\
\midrule
Mean & 23.1 & 7.35 & 3.55 & 1213.5 & 9.56 & 4.27 & 70 \\
\bottomrule
\end{tabular}
\end{table*}

\section{Measurement of Natural Time Constant $\tau$} \label{sec:tau-nat}

%% run thesis/ana_tau_nat.m for results

The approach described in \sectionref{sec:tau-nat-theory} was used to measure the natural time constant $\tau$.
The response to a step-function change in applied heater power was measured at bias points near the top of the transition at $T_{b} = \SI{1100}{\mK}$.
The response to multiple steps was averaged together prior to making a fit.
For each bias point the time constant $\tau_{meas}$ and change in \TES\ current $\delta I$ was obtained from curve fits to \eqnref{eqn:htr-step-resp-high-time}.
A fit was then performed to \eqnref{eqn:teff-from-tau}:
\begin{equation} \label{eqn:tau-nat-fit}
  \tau_{meas} = \tau - \tau \mathcal{K} (I_{bias} \delta I).
\end{equation}
In this fit, $\tau_{meas}$ is considered the dependent variable, the product $(I_{bias} \delta I)$ is the independent variable, and the variables that are fit for are $\tau$ and $\mathcal{K}$.

\figref{fig:tau-nat-plots} shows an example of fitting to \eqnref{eqn:tau-nat-fit}, and the measured values of $\tau$ are listed in \tableref{tab:basic-det-props}.

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-tau-nat-plots.pdf}
\caption[Plot showing measurement of natural time constant $\tau$]{
  Plot showing measurement of natural time constant $\tau$ for \RCm{31}{1}. The fit is to \eqnref{eqn:tau-nat-fit}.
  The y-intercept at $I_{bias} \delta I = 0$ gives $\tau = \SI{9.45}{\ms}$.
} 
\label{fig:tau-nat-plots}
\end{figure*}

\section{Measurement of \textsc{TES} $G$} \label{sec:g-psat}

%
% thesis/ana_g() followed by thesis/genplot_ch6_g
%

With knowledge of the heater resistances, \IV\ curves can be taken over a wide range of bath temperatures, which enables a measurement of the \TES\ thermal conductance $G$, critical temperature $T_C$ and power-flow index $n$.
I took \IV\ curves at bath temperatures ranging from \SIrange{995}{1160}{\mK}, while adjusting the applied heater power so that each \IV\ curve had a clear normal branch.
Fits were performed against \eqnref{eqn:ch3-g-fit}:
\begin{equation}\label{eqn:g-fit}
P_{htr} + P_J + P_{opt}= \frac{G T_c}{n}\left(1 - \left(\frac{T_b}{T_c}\right)^n\right).
\end{equation}
The parameters to be fit to are $G$, $T_c$, and $n$.

A problem arises because the data described in this section were taken when the cryostat was open, so that $P_{opt}$ was non-zero, with an unknown value.
Because $P_{opt}$ is a simple additive constant, it is not possible to fit for this value unless another constraint is known, such as the value of $T_c$.
Unfortunately, the \TES\ circuit bias loop contains Al wire bonds, which have a $T_c$ close to that of the detectors themselves, making a direct measurement of the detector's $T_c$ difficult.

However, the value of $P_{opt}$ can be estimated in two different ways. 
First, the predicted optical load of \SI{180}{\pW} from \sectionref{sec:ch4-optical-design} can be used.
Second, optical load on the prototype detectors was estimated to be in the range \SIrange{135}{165}{\pW} using \IV curve measurements.
In this analysis I assume $P_{opt} = \SI{150}{\pW}$, while also showing how different assumptions change the values of  $G$, $T_c$, and $n$.

\tableref{tab:basic-det-props} lists the resulting values for $G$, $T_c$ and $n$.
\figref{fig:heater-g-plots} contains a plot of the data and fit for \RCm{31}{2}, as well as scatter plots showing measurements of $G$, $T_c$ and $n$.
\figref{fig:heater-g-popt-plots} shows the effect of different assumptions for $P_{opt}$ on measurements of $G$ and $T_c$.
The effects on $G$, $T_c$ and $n$ introduced by the unknown value of $P_{opt}$ are different.
$G$'s uncertainty from $P_{opt}$ is about the same size as the statistical uncertainty due to the fit, while $T_c$'s uncertainty from $P_{opt}$ is much larger than the statistical uncertainty.
$n$ shows no apparent trend with $P_{opt}$.
Specifically, a change in $P_{opt}$ from \SI{100}{\pW} to \SI{300}{\pW} increases $G$ by \SI{5.7}{\percent}, increases $T_c$ by \SI{2.2}{\percent}, and leaves $n$ unchanged.

\begin{figure*}
\includegraphics{drawings/ch6-g-plots.pdf}
\caption[$G$, $T_c$, and $n$ measurements]{
Plots summarizing results of $G$, $T_c$ and $n$ measurements for seven detectors with working heaters.
All error bars and ellipses are 95 \% confidence intervals for statistical error; any systematic error is not included.
\textbf{Left} Plot showing $P_{sat}$ vs $T_b$ for \RCm{31}{2}, assuming $P_{opt} = \SI{150}{\pW}$.
The red line shows the best fit to \eqnref{eqn:g-fit}.
The data covers 25 temperatures from \SIrange{995}{1160}{\mK}, and 11 different heater biases.
\textbf{Center} Scatter plot showing correlation between $G$ and $n$, as well as error ellipses showing covariance between the estimated $G$ and $n$ vales.
\textbf{Right} Scatter plot showing correlation between $G$ and $T_c$, as well as error ellipses showing covariance between the estimated $G$ and $T_c$ vales.
} 
\label{fig:heater-g-plots}
\end{figure*}

\begin{figure*}
\includegraphics{drawings/ch6-g-popt-plots.pdf}
\caption[Impact of different $P_{opt}$ assumptions]{
Plots showing effect of $P_{opt}$ assumptions on $G$ and $T_c$ measurements.
\textbf{Left} Plot showing variation of $G$ for \RCm{31}{2} vs assumed value of $P_{opt}$.
The statistical uncertainty in $G$ for this detector is approximately the same as the systematic uncertainty that results from the estimation of $P_{opt}$.
\textbf{Right} Plot showing variation of $T_c$ for \RCm{31}{2} vs assumed value of $P_{opt}$.
In this case the systematic uncertainty is larger than the statistical uncertainty, although the change is only \SI{2.2}{\percent} as $P_{opt}$ increases from \SI{100}{\pW} to \SI{300}{\pW}.
The value of $n$ shows no trend with $P_{opt}$.
} 
\label{fig:heater-g-popt-plots}
\end{figure*}

As discussed in \sectionref{sec:det-parm-choice}, the target $G$ value for these detectors was 3.7~nW/K.
The mean value for the seven measured detectors is \SI{7.35}{\nano\watt\per\kelvin}, \abt{2} times larger than the target.
The reason for this discrepancy is not known.
%thz5 high g - 67 um 
%thz5 high g - 80 um 
%thz4 proto - 40 um

\section{Direct Measurement of Detector Responsivity and $\tau_{eff}$} \label{sec:teff-resp}

%
% thesis/ana_heater_step() ... note that the file is created inside fit_heater_step()
%

Knowledge of $R_{htr}$ allows a direct measurement of the DC responsivity and $\tau_{eff}$ for the seven detectors with heaters.
Steps in heater bias current were applied to these detectors under \SOC.
The step size was made small so as to keep the detector response linear, and the response to many steps was averaged together to reduce noise.
The result was fit to \eqnref{eqn:htr-step-resp-high-time}:
\begin{equation} \label{eqn:ch6-heater-step-trans}
  \delta I(t) = - \delta P_{htr} s_I(0) (1 - e^{-t/\tau_{eff}}).
\end{equation}
\figref{fig:ch6-heater-step-trans} shows a sample fit to \eqnref{eqn:ch6-heater-step-trans}.
\tableref{tab:trans-det-props} lists the best-fit values of $s_I(0)$ and $\tau_{eff}$.

\begin{figure*}
\centering
\includegraphics{drawings/ch6-heater-step-trans.pdf}
\caption[Detector response to heater steps]{
Plot showing response of detector \RCm{30}{1} to step in applied heater power of \SI{1.41}{\pico\watt}.
Plots are for \RCm{30}{1} biased into \SOC.
The data averaged over 32 steps (16 up and 16 down), along with best fit to \eqnref{eqn:ch6-heater-step-trans}, are plotted.
The step in applied power begins at $t \approx \SI{0.6}{\ms}$, not $t = \SI{0}{\ms}$.
} 
\label{fig:ch6-heater-step-trans}
\end{figure*}

\begin{table*}[t]
\centering
\caption[Detector properties while biased into transition]{
Detector properties while biased into transition.
$P_{opt} = \SI{150}{\pW}$ is assumed everywhere.
%Uncertainties are 95 \% confidence intervals after marginalizing over other fit parameters, and do not include systematic uncertainties due to the unknown value of $P_{opt}$, uncertainty in the value of the shunt resistors, or possible errors in the calibration of the focal plane thermometer.
Values are for detectors under \SOC.
``N/A'' indicates a property that has not been measured for that detector.
}
\label{tab:trans-det-props}
\begin{tabular}{l l l l l l l l}
\toprule
Detector &  $s_I(0)$ (\si{\per\uV}) & $\tau_{eff}$ (\si{\ms}) & $R$ (\si{\mOhm}) & $R/R_n$ & \Loop & $\alpha$ & $\beta_I$ \\
\midrule
\RCm{29}{1} & 0.612 & 3.17 & 3.51 & 0.80 &  2.6 &  59 & 0.32 \\
\RCm{30}{1} & 0.691 & 2.44 & 3.34 & 0.76 &  4.0 &  90 & 0.45 \\
\RCm{31}{1} & 0.605 & 3.25 & 3.25 & 0.71 &  2.9 &  66 & 0.44 \\
\RCm{32}{1} & 0.687 & 2.81 & 2.72 & 0.62 &  8.9 & 155 & 1.98 \\
\RCm{29}{2} & 0.663 & 2.83 & N/A & N/A & N/A & N/A & N/A \\
\RCm{31}{2} & 0.731 & 2.44 & N/A & N/A & N/A & N/A & N/A \\
\RCm{32}{2} & 0.681 & 3.24 & N/A & N/A & N/A & N/A & N/A \\
\bottomrule
\end{tabular}
\end{table*}

\section{Bias Step Analysis: \Loop\ and $\beta_I$} \label{sec:bias-step}

As described in \sectionref{sec:lin-tes-eqn}, steps in the applied bias current can be used to measure \Loop, $\beta_I$ and $R$ for a detector.
In order to make this measurement, the data acquisition rate must be fast enough to track the fast electrical response of the \TES.
In addition, the servo roll-off must be either fast enough not to affect the electrical response, or the effect of the servo roll-off must be included in the fit.

I took measurements at \SI{15625}{\hertz}, which is fast enough to track the electrical response.
I found that the servo roll-off was too slow to be ignored for many detectors, so the function to be fit to is \eqnref{eqn:bias-step-resp} after being passed through a single pole lowpass filter with time constant $\tau_{servo}$; $\tau_{servo}$ is thus one of the parameters to be fit.
The data was taken at bias \DAC\ values of 25000, 26000, 27000, 28000, 29000, 30000, 31000 and 32000.

\figref{fig:ch6-bias-step-plots} and \figref{fig:ch6-bias-step-results} show the results of these measurements for the four detectors on column 0 with working heaters.
The response to many steps is averaged together.
The fits are generally good, but at some bias points a damped oscillatory response is present on top of the expected \eqnref{eqn:bias-step-resp} response.
The source of this is not understood; two possible explanations are the presence of an additional ``dangling'' heat capacity in the electrothermal circuit of \figref{fig:elec-thermal-circuit} \cite{hoevers_thermal_2000,zink_array-compatible_2006,maasilta_complex_2012}, or non-smooth structure in the detector's $R(T,I)$ curve.

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-bias-step-plots.pdf}
\caption[Plots showing response of a detector to bias steps]{
  Plots showing response of a detector to bias steps.
\textbf{Left}
Response of \RCm{31}{1} to step in applied bias current, at a range of bias points.
In all cases there is a fast increase in the \TES\ current followed by a slow decay to the final current, which for these bias points is always less than the initial current.
This drop in current is a result of electrothermal feedback.
As the detector is biased deeper into the transition the decrease in current becomes larger, as a consequence of increasing loop gain and decreasing bias voltage; see \eqnref{eqn:si-full}.
\textbf{Upper Right}
Close-up view of initial stage of detector response.
Both the data and the best-fit curve to \eqnref{eqn:bias-step-resp} are shown, and the responses are offset vertically for clarity.
At some bias points a damped oscillatory response is present on top of the \eqnref{eqn:bias-step-resp} response; the source of this is not understood.
}
\label{fig:ch6-bias-step-plots}
\end{figure*}

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-bias-step-results.pdf}
\caption[Results of bias step fits]{
  Plots showing results of fits for the four detectors tested at varying bias points in this section.
  The circled points are for \SOC.
}
\label{fig:ch6-bias-step-results}
\end{figure*}

Once values for \Loop, $\beta_I$ and $R$ are known, the \DC\ responsivity $s_I(0)$ and $\tau_{eff}$ can be calculated from \eqnref{eqn:si-full} and \eqnref{eqn:teff} respectively.
To check the accuracy of these calculations, I also measured the response of the detectors to steps in applied heater power at the same bias points for four of the seven detectors.
The results of these measurements, as well as the ratio of the calculated to measured values, are shown in \figref{fig:ch6-heater-step-pred-plots}.
The agreement between the calculated and measured values is good, indicating that response to detector bias steps can be used to predict $s_I(0)$ and $\tau_{eff}$ with good accuracy.
This is important because only a few detectors have working heaters, making direct measurements of $s_I(0)$ and $\tau_{eff}$ impossible for most detectors.

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-heater-step-pred-plots.pdf}
\caption[$\tau_{eff}$ and $s_I(0)$ measurements]{
  Plots showing measurements of detector response times $\tau_{eff}$ and responsivity $s_I(0)$ for the four detectors of column 0 with working heaters.
  The circled points are for the \SOC.
\textbf{Upper Left}
Measurements of $\tau_{eff}$ for a range of bias points.
\textbf{Upper Right}
Measurements of $s_I(0)$ for a range of bias points.
\textbf{Lower Left}
Comparison of predicted and measured $\tau_{eff}$ for the same detectors.
\textbf{Lower Right}
Comparison of predicted and measured $s_I(0)$ for the same detectors.
}
\label{fig:ch6-heater-step-pred-plots}
\end{figure*}

Bias steps were also taken for all working detectors at \SOC.
\figref{fig:ch6-all-loop-plots} summarizes these measurements of \Loop, $\beta_I$, and $R$, both in terms of histograms for each parameter as well as scatter plots showing covariance between them.
\figref{fig:ch6-teff-si-pred} shows histograms of the resulting predictions for $\tau_{eff}$ and $s_I(0)$.
\SI{78}{\percent} of the working detectors have $\tau_{eff} < \SI{2}{ms}$.
%xxx comment on this speed compared to required.

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-all-loop-plots.pdf}
\caption[Plots summarizing results of bias step measurements for all working detectors]{
  Plots summarizing results of bias step measurements for all working detectors.
All data taken at \SOC.
\textbf{Left Plots}
Histograms showing measured values of \Loop, $\beta_I$ and $R$.
\textbf{Right Plots}
Scatter plots showing how the three parameters \Loop, $\beta_I$ and $R$ correlate with each other.
Note that $R$ is plotted, not $R/R_n$. This is because $R_n$ is known only for those detectors on columns 0 and 1 with working heaters (see \sectionref{sec:heater-r}).
}
\label{fig:ch6-all-loop-plots}
\end{figure*}

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-teff-si-pred.pdf}
\caption[Predictions for $\tau_{eff}$ and $s_I(0)$]{
  Plots showing distribution of predicted $\tau_{eff}$ and $s_I(0)$. The predictions use \eqnref{eqn:teff} and \eqnref{eqn:si-full}, with the values for $R$, \Loop and $\beta_I$ shown in \figref{fig:ch6-all-loop-plots}, and $R_{sh}$ values from \sectionref{sec:shunt-nyquist}. $R_p$ is assumed to be zero in all cases.
}
\label{fig:ch6-teff-si-pred}
\end{figure*}

\section{Common Mode Signal and $1/f$ noise} \label{sec:ch6-common}

% thesis/ana_common_mode() for all numbers

Our detectors have significant $1/f$ noise, with a \SI{3}{\decibel} knee of $\abt{\SI{0.7}{\hertz}}$.
Most of this noise is due to bath temperature fluctuations which are uncontrolled by the Cryocon \PID\ loop.
\figref{fig:ch6-cm-plots} contains plots summarizing this common-mode signal and $1/f$ noise.
The upper left plot shows raw 10 minute detector timestreams for 15 detectors.
The common mode signal is evident in these plots, and is much stronger than the white noise at frequencies of \SI{1}{\Hz} and slower.
The upper right plot shows the same detector timestreams after removal of the mean of all ``good'' timestreams for columns 0 and 1 (the only columns which were biased for this test).
The large reduction of $1/f$ noise is evident in this plot.
The lower left plot shows direct evidence for this via the current noise power spectral density both before and after subtracting the common mode.
Also plotted is the power spectral density after subtracting first the common mode and then the best-fit 4th order polynomial from the raw detector timestream.
Subtracting the 4th order polynomial does reduce noise at very low frequencies, but the effect is small.

The power spectral density plot has two important features.
First, a strong noise peak is located at \SI{1.411}{\Hz}.
This is caused by the \abt{\SI{1.4}{\Hz}} cycle of the \PTC; the physical mechanism could either be microphonic pickup of the vibrations caused by the \PTC\ cycle, or variation in bath temperature induced by the cycle.
This signal can be removed either through a common-mode subtraction scheme or a notch filter.
Second, the detector noise signal is unaffected by the common mode signal at frequencies faster than \SI{2}{\Hz}.
Because the frame rate of the video system is 6 FPS or faster, this indicates that the only impact of the strong common-mode noise signal on videos is the need to account for a time-varying detector offset.
Our approach to dealing with this offset is covered in \sectionref{sec:ch7-algo}.

The lower right plot in \figref{fig:ch6-cm-plots} shows the detector timestream for \RCm{29}{1}, translated into variation in bath temperature.
We can define a differential thermal conductance relative to changes in bath temperature $G_b$ via
\begin{equation}
  G_b \equiv \frac{dP_b}{d T_b} = G \left( \frac{T_b}{T} \right)^{n-1}.
\end{equation}
Then the equivalent bath temperature change for a given \TES\ current change will be given by
\begin{equation}
  \Delta T_b = \frac{\delta I}{s_I(0) G_b}.
\end{equation}
For this test the bath temperature was set to \SI{1100}{\mK}, so the implied temperature variations over several-minute timescales are a few parts in $10^{4}$.

\begin{figure*}
\includegraphics{drawings/ch6-cm-plots.pdf}
\caption[Plots summarizing common mode signal and $1/f$ noise]{
Plots summarizing common mode signal and $1/f$ noise.
\textbf{Upper Left}
Plot showing raw detector output for 15 detectors over a 10-minute data acquisition.
The data was acquired at \SI{312.5}{\Hz}, but only every 100th data point is plotted.
\textbf{Upper Right} 
The same data after removal of the common mode signal (as defined in the text).
\textbf{Lower Left} 
Current noise power spectral density for the raw data, the raw data minus the common mode (``No CM''), the raw data minus the common mode and the best-fit 4th-order polynomial (``No CM, Poly''), and the common mode itself (``CM'').
The strong noise peak at \SI{1.411}{\Hz} is due to the \PTC, as explained in the text.
\textbf{Lower Right} 
Raw timestream for \RCm{29}{1}, after conversion to an equivalent bath temperature variation, as described in the text.
}
\label{fig:ch6-cm-plots}
\end{figure*}

\section{Microphonic Pickup} \label{sec:ch6-microphonic-pickup}

% Run thesis/ana_ptc for results

\TES\ detectors can be prone to microphonic pickup.
The earliest version of the cryostat used for this project used a Gifford-McMahon (\GM) cryocooler, which vibrates the cryostat significantly more than a \PTC\ does.
The prototype detectors had significantly higher noise levels with the \GM\ cooler running than when it was off; in addition, the detector noise could be directly increased by striking the side of the cryostat with a soft mallet while the \GM\ cooler was turned off.
I interpreted this behavior as evidence for microphonic pickup, and as a result replaced the \GM\ cooler with a \PTC.

To check whether microphonic pickup was present for the production detectors and the \PTC, I took noise data both with the \PTC\ running and turned off.
In both cases the bath temperature was held steady at \SI{1100}{\mK} using the Cryocon temperature controller.
Common mode noise was removed and power spectra for each detector were calculated.
Then the excess noise for each detector was calculated as
\begin{equation}
  \sqrt{  \frac{ {\displaystyle \sum_{f \ge 6}} S^2_{I,\textsc{ptc}}(f) }
               { {\displaystyle \sum_{f \ge 6}} S^2_{I,\mbox{\tiny{No}}\textsc{ ptc}}(f) }}
\end{equation}
where $S^2_{I,\textsc{ptc}}$ and $S^2_{I,\mbox{\tiny{No}}\textsc{ ptc}}$ are the measured current noise power spectral densities with the \PTC\ turned on and off, expressed in units of \si{\A^2 \per \Hz}.

\figref{fig:ch6-ptc-plots} shows a histogram of this excess noise.
Most detectors have higher noise with the \PTC\ on, but the mean excess noise is only \SI{1}{\percent}.
The figure also contains a plot of the power spectral density for \RCm{29}{1} with the \PTC\ on and off.

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-ptc-plots.pdf}
\caption[Plots showing impact of \PTC\ on noise]{
Plots showing impact of \PTC\ on noise.
\textbf{Left}
Histogram showing excess noise due to the \PTC, defined as ratio of total noise above \SI{6}{\Hz} (see text for precise definition).
More detectors have higher noise with the \PTC\ on than off, but the mean excess noise is only \SI{1}{\percent}.
\textbf{Right}
Current noise for \RCm{29}{1} with \PTC\ on and off, after subtracting common mode noise.
The noise below \SI{30}{\Hz} is 1.5--2.5 times higher with the \PTC\ on, but the total noise at the relevant frequencies of $f >= \SI{6}{\Hz}$ is only \SI{2.9}{\percent}.
}
\label{fig:ch6-ptc-plots}
\end{figure*}

\section{Noise Aliasing} \label{sec:ch6-aliasing}

As explained in \sectionref{sec:det-readout}, the \MCE\ takes data at \SI{15625}{\hertz}, but is only capable of sending data for the 251-detector sub-array to the readout computer at \SI{3125}{\hertz}.
This raises the question of how much noise is aliased from the \SIrange{3125}{15625}{\hertz} band to below \SI{3125}{\hertz}.
To check this I acquired data under \SOC\ for column 0 at the normal rate of \SI{3125}{\hertz} as well as at \SI{15625}{\hertz}.
Five data files were acquired for each case.
For each row in column 0 and for each data file a power spectrum was taken after subtracting the common mode signal, and the excess noise was calculated as
\begin{equation}
  \sqrt{  \frac{ {\displaystyle \sum_{6 \le f \le 1562.5}} S^2_{I,3125}(f) \Delta f }
               { {\displaystyle \sum_{6 \le f \le 1562.5}} S^2_{I,15625}(f) \Delta f }}
\end{equation}
where $S^2_{I,3125}$ and $S^2_{I,15625}$ are the measured current noise power spectral densities at the two different multiplexing rates, averaged over all 5 data files, expressed in units of \si{\A^2 \per \Hz}.
The sums are performed only over those frequency components in the range \SIrange{6}{1562.5}{\Hz}, and note that $\Delta f$ is different for the two sampling rates.

\figref{fig:ch6-noise-aliasing} summarizes the results.
The average excess noise due to aliasing is \SI{16}{\percent}, but some detectors have statistically significant higher levels of aliased noise; for example, \RCm{20}{1} has \SI{29}{\percent} excess noise.

The servo feedback parameter for these acquisitions was $I_{FB} = 50$, but when taking video images $I_{FB}$ is typically set to 10 or 20.
Because the slower servo feedback will roll off noise above \SI{3125}, the level of aliased noise will be lower under these configurations.

The \MCE\ can be configured to apply a 4-pole digital lowpass filter to the \SI{15625}{\Hz} data stream prior to sampling at \texttt{data\_rate} \cite{mce_team_digital_????}.
An appropriate choice of the cutoff frequency for this filter can greatly reduce aliased noise.
I have not yet implemented this filter, but plan to do so for future operation of the system.

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-noise-aliasing.pdf}
\caption[Plots showing impact of noise aliasing]{
Plots showing impact of noise aliasing.
\textbf{Left}
Plot showing fractional excess noise (see text for definition) due to noise aliasing for all rows of column 0.
The error bars are for \SI{95}{\percent} confidence intervals, and the median excess noise is \SI{12}{\percent}.
\textbf{Right}
Sample power spectra at \SI{3125}{\hertz} and \SI{15625}{\hertz} for \RCm{5}{1}.
For this detector the excess noise is \SI{17}{\percent}.
}
\label{fig:ch6-noise-aliasing}
\end{figure*}

\section{Detector Noise} \label{sec:det-noise}

While taking the \Loop and $\beta_I$ measurements described in \sectionref{sec:bias-step}, I also took noise data for the four detectors with working heaters on column 0.
For each data acquisition the common mode signal was subtracted and the power spectra calculated using \MATLAB's \texttt{pwelch} function.
\figref{fig:ch6-trans-noise} shows the resulting power spectra, both in terms of the directly measured current noise $S^2_I$, as well as in terms of noise referred to power absorbed in the bolometer, $S^2_{P}$.
$S^2_{P}$ is calculated via
\begin{equation}
 S^2_{P} = S^2_I / s_I(0),
\end{equation}
where here the \DC\ detector responsivity $s_I(0)$ is calculated using the measurements described in \sectionref{sec:bias-step}.

Also plotted is the predicted detector noise level for each detector at each bias point, using a ``basic'' noise model.
This basic noise model uses the values of $\tau_{eff}$ and $s_I$ calculated in \sectionref{sec:bias-step}, and the values of $G$ and $T_c$ measured in \sectionref{sec:g-psat}, assuming \SI{150}{\pW} of optical power.
All three sources of detector noise from \sectionref{sec:ch3-tes-noise} are included.
The predicted photon noise level of \Pnoisef{0.85} from \sectionref{sec:ch5-predicted-noise} is also included.

Several features are visible in these plots.
First, \RCm{30}{1} shows several noise lines, the origin of which is not understood.
Second, for all four detectors the spread of noise levels in the \SIrange{1}{20}{\hertz} is much smaller when referred to power absorbed on the bolometer than in terms of current noise.
This is the expected behavior for a noise source that adds power directly to the bolometer.
When expressed in terms of power absorbed in the bolometer, such noise will be the same at all bias points.
But because detector responsivity changes with bias point, the noise level will be different when expressed in terms of current.
Third, the shape of the noise curves are roughly as expected, with noise roll-offs happening at approximately the correct frequencies.
Fourth, the measured noise levels are much higher than the predicted noise levels.
\RCm{29}{1} is 1.9 times higher, \RCm{30}{1} is 5.8 times higher (dominated by the noise spikes), \RCm{31}{1} is 1.7 times higher and \RCm{32}{1} is 1.6 times higher.

The reason for this high level of noise is not known.
Two possible culprits are a higher than expected level of photon noise or a much larger value of $G$ than was measured.
Both of these possibilities would affect the noise spectrum in the same way, so they can not be distinguished.
\figref{fig:ch6-trans-noise-model-plots} plots the measured noise spectrum for \RCm{31}{1} at \SOC, along with the basic noise model and a noise model that includes enough additional power noise to match the measured white noise level at low frequencies.
This could be due to a value of $G$ that in reality is 4.8 times higher than what was measured, or a photon noise level that is 1.9 times higher than predicted.

One problem with explaining the noise spectra this way is that the measured spectrum shows a shelf at \SIrange{100}{1000}{\hertz} which is not present in any of the models.
A second problem is that it is difficult to understand how the measured value of $G$ could be so far off.
Excess photon noise seems a more likely explanation, and could be due to \IR\ power leaking onto the detectors.
Even a small amount of \IR\ power can increase noise levels through the $\nu$ factor in \eqnref{eqn:photon-noise}.
It is also possible that a much higher level in-band optical power is falling on the detector than predicted.
This would both increase the photon noise directly, and increase the predicted thermal fluctuation noise because of the link between assumed optical power and my measurements of $G$ and $T_c$ as discussed in \sectionref{sec:g-psat}.

Another possible explanation is a poor calibration of the readout system, so that the ``real'' current noise is \abt{2} times lower than measured.
However, this would reduce the measured values of $R_{sh}$ and $L_{ny}$ by a factor of $2^2=4$.
This is unlikely, because the measured values are close to the design values, and these design values have been confirmed by measurements of other interface chips of the same design\footnote{John Appel, personal communication}.

I therefore conclude that the high level of detector noise is real, but I do not yet have a full explanation for the high values.

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-trans-noise.pdf}
\caption[Detector noise measurements]{
Plots showing detector noise for the four detectors with working heaters on column 0.
The left column plots the directly measured current noise, after removing a common mode signal, at eight bias points from 25k to 32k.
The right column shows the same noise spectra, but referred to power absorbed in the bolometer.
For all four detectors, there is less spread in the low-frequency power noise than in the current noise, suggesting that the dominant source of noise at these frequencies deposits power on the bolometers.
This behavior is expected of either thermal fluctuation noise or photon noise.
Also plotted in the right column is the predicted noise spectrum, using parameters taken from \sectionref{sec:bias-step}, including \Pnoisef{0.85} of photon noise.
For all four detectors, the measured noise is higher than predicted by the noise model.
}
\label{fig:ch6-trans-noise}
\end{figure*}

\begin{figure*}
  \centering
\includegraphics{drawings/ch6-trans-noise-model-plots.pdf}
\caption[Measured and modeled noise]{
  Plot showing measured noise for \RCm{31}{1}, referred to power absorbed in bolometer, along with two noise models.
The red line is the basic detector noise model using measured values for all detector parameters as described in this chapter, including predicted \Pnoisef{0.85} of photon noise.
The black line is for a noise model that include enough excess ``power'' noise to match the measured white noise level at low frequencies.
This excess ``power'' noise could be due to a high level of photon noise (1.9 times higher than predicted) or a larger-than-measured value of $G$ (4.8 times higher than measured), or some combination of the two.
}
\label{fig:ch6-trans-noise-model-plots}
\end{figure*}

% I'm removing this stuff because after thinking about it some more,
% I'm not sure why point I'm really trying to make here. So drop it.
%
% Finally, \figref{fig:ch6-all-noise} contains a histogram of the total noise in each detector using three different values for the servo gain $I_{FB}$: 50, 20, and 10.
% The total noise is defined as
% \begin{equation} \label{eqn:ch6-tot-noise-defn}
%   \sqrt{ \sum_{f \ge \SI{6}{\hertz}} S^2_P(f_j) \Delta f}.
% \end{equation}
% Lower servo gains reduce the \SQUID\ and other out-of-band noise, so that the total noise decreases with decreasing $I_{FB}$.
% The detectors also become more tightly bunched in their noise performance at lower servo gain.

% \begin{figure*}
%   \centering
% \includegraphics{drawings/ch6-all-noise.pdf}
% \caption[Total in-band noise]{
% Histograms showing total in-band noise for all working detectors at three different servo gain values.
% The total noise deceases as servo gain is decreased, as a result of the servo loop reducing \SQUID\ and detector noise that is outside the bandwidth of the detector.
% Fewer outlier detectors also appear at low servo gain.
% The rightmost bins include all values great than \SI{100}{\fW}.}
% \label{fig:ch6-all-noise}
% \end{figure*}

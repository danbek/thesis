\chapter{Subarray Characterization}\label{c:det-array}

The detectors in the first 251-detector subarray have not all been characterized to the same extent.
Partly this is due to manpower and time constraints.
Additionally, as described in \sectionref{sec:g-psat}, the saturation power of the detectors is \abt 2 times higher than expected, which means that only some detectors be driven normal, and only at bath temperatures very close to $T_c$.
In particular, none of the detectors can be driven normal at the operating bath temperature for the array of 1100~mK.
This means that we do not have \IV\ curves for any detectors at operating conditions, which limits the characterization than can be performed.

Seven detectors used in taking images have working heaters and no other problems.
These heaters allow us to take full \IV\ curves at all bath temperatures, allowing estimate of the detector thermal conductance $G$.
The heaters also allow a direct measurement of detector responsivity and time constants, and thus allow a measurement of detector noise referred to optical power incident on the detector.
These later measurements have been carried out on four of the seven detectors.
Additionally, \Loop, $\beta_I$ and $R$ at operating conditions have been measured for all working detectors.
This chapter describes all these measurements, as well as measurements of shunt resistors and inductors for all detectors.
\tableref{tab:measurements} summarizes all of the measurement that have been performed and described in this chapter.
Sections discussing common mode noise, microphonic pickup and noise aliasing are also included.

Note that this lack of detector characterization does not prevent the array from working.
It merely limits our understanding of the behavior of the detectors.
A more detailed characterization of more detectors will be carried out prior to fabrication of any additional arrays.

\begin{table*}[t]
\centering
\caption{Summary of measurements made on first 251-detector subarray}
\label{tab:measurements}
\begin{tabular}{l l l}
\toprule
Measurement &  Section & Which Detectors  \\
  \midrule
Choice of Optimal \MCE\ servo gain parameters & \ref{sec:mce-servo-gain} & All columns \\
$R_{sh}$ and $L_{ny}$ & \ref{sec:shunt-nyquist} & All working detectors \\
Heater Resistors & \ref{sec:heater-r} & Seven detectors with good heaters on column 0 and 1 \\
$\tau$ & \ref{sec:tau-nat} & Four detectors with good heaters on column 0 \\
$G$, $T_c$, $n$, $P_{sat}$ & \ref{sec:g-psat} & Seven detectors with good heaters on column 0 and 1 \\
$\tau_{eff}$ and \DC\ responsivity & \ref{sec:teff-resp} & Seven detectors with good heaters on column 0 and 1 \\
\Loop, $\beta_I$, $R$ at a range of bias points & \ref{sec:bias-step} & Seven detectors with good heaters on column 0 and 1 \\
\Loop, $\beta_I$, $R$ at standard operating conditions & \ref{sec:bias-step} & All working detectors\\
Detector noise at a range of bias points & \ref{sec:det-noise} & Four detectors with good heaters on column 0 and 1 \\
\bottomrule
\end{tabular}
\end{table*}


\section{Choice of \MCE\ Servo Gain Parameters}\label{sec:mce-servo-gain}

As described in \sectionref{sec:det-readout}, the \MCE\ operates the \SQUID\ multiplexing system.
It supports extensive configuration options ranging from \SQUID\ bias current values to multiplexing speed, to the order in which rows should be reported to client software \cite{_mcewiki_2014}.
This thesis does not describe the process of choosing most of these parameters.
The one exception is the choice of \PID\ parameters for the flux-locked-loop servo that linearizes the output of the \SQUID\ amplifier chain.
This section describes the choice of these parameters for different readout situations.

The feedback applied to an \SQ1 during frame $n+1$ is defined as \cite{mce_team_data_2013}
\begin{equation}
  FB_{n+1} = \frac{1}{2^{12}} \left[P q_n + I \sum_{i=1}^n e_i + D (e_n - e_{n-1}) \right].
\end{equation}
Here $e_n$ is the error observed during frame $n$, $q_n \equiv e_n + b q_n$ (where $b$ is some number small than 1), and $P$, $I$, and $D$ are the proportional, integral, and derivative terms of the \PID\ loop, respectively.
The $FB$ values are expressed in terms of \DAC\ counter units applied to the \SQ1 feedback, and the errors $e$ are in terms of \ADC\ values for the output of the readout chain.
The \Imager\ is operated with $P = D = 0$, so that the feedback simplifies to
\begin{equation} \label{eqn:mce-pid-i-only}
  FB_{n+1} = \frac{I}{2^{12}} \sum_{i=1}^n e_i.
\end{equation}

Using only $I$, the \MCE\ servo loop acts like a 1-pole filter.
Higher values of $I$ increase the bandwidth of this filter until a ``critical gain'' is reached, as which point the feedback loop becomes unstable and begins to oscillate.
$I$ should be chosen so that the bandwidth of this filter is greater than that of the detectors themselves, but $I$ should not approach the critical gain too closely.

The servo $I$ parameter was chosen to minimize \SQUID\ noise and allow sufficient bandwidth to readout the full bandwidth of the detectors.
The target servo bandwidth depends on the measurement being made.
When operating the array in normal conditions, the data readout rate is either \SI{3125}{Hz} or \SI{3030.3}{Hz}, depending on whether the dark \SQUID\ is read out.
The time constant for the associated Nyquist frequencies are \abt~\SI{0.1}{ms}, so there is no need to use $I$ values with more bandwidth than this\footnote{Doing so is counter-productive, because it will alias \SQUID\ noise into the detector band}.
Electrical detector time constants are \abt~\SI{4}{ms} in the superconducting state, and \abt~\SI{0.14}{ms} in the normal state.
While biased into the transition, $\tau_{eff}$ is in the range \SIrange{1}{4}{ms}.
\figref{fig:ch8-servo-tau-est} shows the impact of the servo rolloff on estimation of time constants from single-pole response functions.
To reduce the error in the estimated time constant below \SI{2}{\percent}, the servo time constant should be below \SI{5}{\percent} of the time constant to be measured.
This criteria corresponds to \SI{2e-4}{s} for the superconducting state and as fast as \SI{5e-5}{s} for detectors operating in the transition.

\begin{figure*}
\includegraphics{drawings/ch8-servo-tau-est.pdf}
\caption{Plots summarizing requirements on $\tau_{servo}$ for accurate measurements of detector time constants.
\textbf{Left} Plot showing exact response to step function of a detector with $\tau = \SI{4}{ms}$, the response as filtered by a servo with $\tau_{servo} = \SI{1}{ms}$, and the best fit to the filtered response. The estimated $\tau$ is \SI{23}{\percent} too high.
\textbf{Right} Plot showing fraction overestimate of $\tau$ vs. relative size of $\tau_{servo}$.
For less than \SI{2}{\percent} error, $\tau_{servo}/\tau < \num{0.05}$ is required.
}
\label{fig:ch8-servo-tau-est}
\end{figure*}

Measuring the bandwidth of the servo loop is challenging because when the detectors are in the superconducting state the Johnson noise of the shunt resistor is higher than the \SQUID\ noise and the Johnson noise rolloff is \abt \SI{4}{\ms}, both factors which make it difficult to identify the servo rolloff from power spectra.
However, if the bath temperature is raised above $T_c$ for the Al wirebonds connecting the \TES\ circuit to the input coils of the 1st stage \SQUIDs, the total resistance of the \TES\ circuit is raised from \SI{150}{\uohm} to \SIrange{20}{50}{\mohm}.
This high resistance drives the Johnson noise of the load resistor below the \SQUID\ noise, and pushes the $L/R$ rolloff of the Johnson noise to \SI{3e-5}{s} or faster (\SI{3}{\dB} frequency of \SI{5}{\kilo\Hz} or higher), making a measurement of the servo bandwidth much easier.

To choose $I$ values, I acquired data at the fastest multiplexing rate possible for 33 rows\footnote{This rate is achieved by only reporting one of the eight columns to the readout computer. The limiting factor in how fast the entire array can be multiplexed is packaging and sending the data to the readout computer.}, \SI{15151.5}{Hz} while the system was at a temperature of \SI{1.3}{\K}.
For every row and column that has a detector that responds in the superconducting state, I fit the resulting noise power spectrum to an equation of the form
\begin{equation}
  \frac{N_{SQ}}{1 + (2 \pi \tau_{servo})^2},
\end{equation}
Where $N_{SQ}$ is the white noise level and $\tau_{servo}$ gives the bandwidth of the servo loop.

\figref{fig:ch8-servo} shows the resulting white noise levels and $\tau_{servo}$ values for a range of servo gain values $I$.
The \SQUID\ white noise level is higher when operating with negative $I$ values, so we have chosen to use positive $I$ values.
When measuring time constants $I=50$ has been used for all columns, to maximize the number of detectors below the $\tau_{servo} =$ \SIrange{2e-4}{5e-5}{s} range.
This also places most detectors in a region where \SQUID\ noise will be aliased into the measurement band, but because I always average over many measurements, this is not a major concern.

For taking video images, the servo does not need to be run as aggressively.
As shown in \figref{fig:ch8-teff-si-pred}, most detectors have $\tau_{eff}$ right around \SI{1.25}{\ms}, with only a few slower than this.
A servo gain of 20 puts $\tau_{servo}$ below \SI{0.6}{\ms} for all detectors, so there is no need to operate at a higher servo gain when taking video images.
Even operating with a servo gain of 10 puts \SI{95}{\percent} of the $\tau_{servo}$ below \SI{1}{\ms}, so operating at a servo gain of 10 is also acceptable, though not as ideal as 20.

\begin{figure*}
\includegraphics{drawings/ch8-servo.pdf}
\caption{Plots summarizing behavior using different servo gains $I$.
  Box plot boxes represent the \SIrange{5}{95}{\percent} quantiles, middle line the median, upper and lower whiskers the maximum/minimum values, across all rows/columns with detectors that respond in the superconducting state.
\textbf{Upper} Plot of \SQUID\ $\tau_{servo}$ vs servo gain $I$.
Servo bandwidth increases with $I$.
At $I \ge \num{60}$, very small $\tau_{servo}$ begin to appear. This indicates either a rolloff above the bandwidth of the measurement, or the beginning of an unstable servo loop.
The few high $\tau_{servo}$ values at gains of 80 and 100 are a result of the fitting routine failing, probably due to an unstable servo loop.
\textbf{Lower Left} Close-up view of upper plot for gains from 10 to 50.
\textbf{Lower Right} Plot of median \SQUID\ white noise level vs. servo gain $I$. Positive gains consistently give lower dark \SQUID\ noise levels.
}
\label{fig:ch8-servo}
\end{figure*}

%% xxx - do I need to include this stuff?
%% If the slope of the $V-\Phi$ curve for the \SQUID\ amplifier chain at the lock point is $m$, then examination of \eqnref{eqn:mce-pid-i-only} shows that the \PID\ loop is expected to become unstable when
%% \begin{equation}
%%   \frac{I}{2^{12}} m < -1,
%% \end{equation}
%% so that the critical gain $I_{crit}$ is given by
%% \begin{equation} \label{eqn:crit-gain}
%%   I_{crit} = - \frac{2^{12}}{m}.
%% \end{equation}

%% After performing a \SQUID\ tune the \MCE\ reports the slopes at all lockpoints, and these slopes can be used to find the critical gains and this choose value for $I$.
%% \figref{fig:ch8-servo} shows histograms of critical gains for all 256 row/columns of our array, as calculated using \eqnref{crit-gain} and the reported slopes.

%% The \MCE\ supports setting a different $I$ value for every row and every column.

\section{Shunt Resistance Measurements}\label{sec:shunt-nyquist}

Our shunt resistors are located on interface chips that contain both shunt resistors and Nyquist inductors.
The specific chips used were extra chips leftover from the ABS\cite{kusaka_modulation_2013} project.
The design resistance of the shunts was \SI{180}{\uohm}, and the design inductance was 609~nH\footnote{John Appel, personal communication}.
Each chips contains 32 shunt resistors and 32 inductors.

To measure $R_{sh}$ and $L$ for these chips I took noise measurements using zero detector bias current at two different bath temperature: 980~mK and 1160~mK.
At these bath temperatures and at zero detector bias the detectors are superconducting, so that measured noise is due to the shunt resistor, any parasitic resistance, and SQUID noise in the multiplexed readout system itself.
Data was collected at 3030.3~Hz, and 20 data acquisitions lasting 33 seconds were taken at each bath temperature.

A power spectrum was estimated for each detector for each data acquisition using \MATLAB's \texttt{pwelch} function, using a \FFT\ size of $2^{12}$.
Each resulting power spectrum was fit to a function of the form
\begin{eqnarray}\label{eqn:scnoise-fit}
	\frac{4 k_B T_b}{R_{sh}} \frac{1}{1 + (2 \pi f (L/R_{sh}))^2} + SQ,
\end{eqnarray}
where $k_B$ is Boltzmann's constant, $T_b$ is the bath temperature for the measurement, and $f$ is the frequency.
The shunt resistance $R_{sh}$, inductance $L$, and readout chain white noise level $SQ$ are the values extracted from the fit.

\figref{fig:rsh-l-plots} shows histogram plots of the resulting \Rsh\ and $L$ values.
\Rsh\ has a mean of \SI{149}{\uohm} with standard deviation \SI{6}{\uohm}.
The measured value for \Rsh\ also includes any parasitic resistance in the circuit, but no evidence for significant parasitic resistance has ever been seen, so this parasitic resistance is assumed to be zero.

The measured value for $L$ includes the Nyquist inductance on the interface chip, the input inductance of the first-stage \SQUID\ of the multiplexed readout system, as well as any parasitic inductance in the circuit.
Using this measurement it is not possible to extract the inductance of the Nyquist induct-or itself, but this is not a problem because the total inductance is the relevant  quantity for understanding the behavior of the detector and its circuit.

$L$ has a mean of 568~nH with a standard deviation of 86~nH.
However, this mean includes two sets of clear outliers: all values for multiplexing row 4 are clustered around 200~nH, and all values for multiplexing row 25 are clustered around 440~nH.
The reason for these low inductances is not understood.
Excluding rows 4 and 25,  $L$ has a mean of 587~nH with a standard deviation of 44~nH.

The outlier $L$ values are more clearly visible in the lower left plot in \figref{fig:rsh-l-plots}, which also shows a small correlation between \Rsh\ and $L$.
It is not known whether this correlation is a real physical effect or an artifact of the measurement process.

\begin{figure*}
\includegraphics{drawings/ch8-rsh-l-plots.pdf}
\caption{Plots summarizing results of measurements of shunts and Nyquist inductors.
\textbf{Upper Left} Histogram of shunt resistance \Rsh.
\textbf{Upper Right} Histogram of total inductance in circuit, which includes the interface chip Nyquist inductor, the inductance of the SQ1 input coil, and any parasitic inductance.
\textbf{Lower Left} Scatterplot showing all measured Rsh and L values. A correlation is apparent, the reason for which is not understood.
\textbf{Lower Right} Plot showing current noise power spectrum extracted from a single data acquisition for \RCm{20}{6}, along with predicted power spectrum based on best fit to \eqnref{eqn:scnoise-fit} across all data acquisitions. The best fit values are $\Rsh=\SI{155}{\uohm}$, $L = \SI{616}{nH}$, and \SQUID\ white noise level of \Inoise{1.2e-10}.}
\label{fig:rsh-l-plots}
\end{figure*}

\section{Measurement of Heater Resistors} \label{sec:heater-r}

Thirty-one detectors have heater resistors connected to bond pads.
Twenty-three of these have the heaters wired to the heater bias line.
Of these 23, there are nine detectors which show no response to applied heater power.
Five of these nine are on the cut list (xxx see ch xxx), so this is not surprising.
But four detectors can be biased into the transition and work well, but show no response to applied heater power (\RC{4}{7}, \RC{5}{7}, \RC{6}{6}, \RC{7}{6}).
The reasons for these detectors not showing a response to heater power are not fully understood.
This leaves 14 working detectors that also show a response to applied heater power.
However, a short between one of the \TES\ bias lines and the heater bias line means that ramping the current bias for some of the \TES\ detectors also ramps the heater bias.
This means that for seven of the 14 working detectors that show a response to applied heater power, interpreting \IV\ curves is difficult because a different amount of heater power is applied at each detector bias value.
This means that for these seven detectors it is not possible to measure $G$ or to calibrate the power being applied by the resistors.

This leaves seven detectors with heaters for which \IV\ curves can be taken, and $G$ measured.
The heaters on these seven detectors can be used to directly measure the detector responsivity, noise referred to input optical power, time constants and thermal conductance $G$.
But all of these measurements require knowing the resistance of the heaters.
This section describes my measurement of the heater resistances.

To measure the heater resistances, I took a set of \IV\ curves at constant bath temperature.
For each \IV\ curve I applied a different heater current, so that a different amount of heater power was applied to the \TES\ for each curve.
The total amount of power flowing through the \TES\ thermal conductance $G$ is then given by
\begin{equation}\label{eqn:tes-ptot}
P_{tot} = K(T^n - T_b^n) = P_{opt} + P_{htr} + I^2 R(T,I),
\end{equation}
where $T$ is the temperature of the \TES, $R$ is the resistance of the \TES, and $I$ is the current flowing through the \TES.
I make the assumption that at the start of the superconducting transition $\beta_I = 0$, i.e.\ the resistance of the \TES\ depends only on the \TES\ temperature, and not on the current through the \TES.
This implies that each time the \TES\ reaches, e.g.\ $0.99R_n$, the temperature of the \TES\ is the same, and therefore $P_{tot}$ will be the same.
A relationship of the following form must therefore hold:
\begin{equation}\label{eqn:rhtr-fit}
P_{J} = (P_{tot} - P_{opt}) - I_{htr}^2 R_{htr}.
\end{equation}
A fit can be made to this function, with the quantities $R_{htr}$ and $P_{x} \equiv P_{tot} - P_{opt}$ to be solved for.

\figref{fig:ch8-heater-r-plots} explains this idea further by a series of plots.
The upper left plot shows the \TES\ \IV\ curves.
The upper right plot shows the same data, but transformed into \TES\ Joule power and \TES\ resistance.
As applied heater current decreases, the Joule power at the start of the transition decreases.
In the lower left, the Joule power at $0.99R_{n}$ is plotted vs applied heater current.
A fit to \eqnref{eqn:rhtr-fit} is also plotted.
Finally, the lower right plot show the $R$ vs $P_J$ plots after the heater power has been added to each curve.
This plot shows that the powers are equalized very high in the transition, where the assumption of Joule power dependent only on \TES\ resistance holds.
It also shows that this assumption breaks down deeper in the transition.

\begin{figure*}
\includegraphics{drawings/ch8-heater-r-plots.pdf}
\caption{Plots heater measurements, for the case of \RCm{29}{1}.
\textbf{Upper Left} \IV\ curves. The \IV\ curves should turn vertical when the detector becomes fully superconducting at zero voltage, but these curves shown a non-infinite slope. The reason for this is that the readout system as configured for these \IV\ curves was unable keep up with the rapid change of current in the superconducting branch.
\textbf{Upper Right} Same data as in upper left plot, but represented in terms of \TES\ Joule power and resistance. As the bias current for the heaters is increased, the curves shift to the left.
\textbf{Lower Left} Measured $P_{J}$ vs heater current at $0.99R_n$, as well as fit to \eqnref{eqn:rhtr-fit}.
\textbf{Lower Right} Same plot as upper right, but the heater power based on $R_{htr} = \SI{23.6}{\ohm}$ has been added to each curve.}
\label{fig:ch8-heater-r-plots}
\end{figure*}

\tableref{tab:basic-det-props} lists all measured heater resistors.
The seven heaters for columns 0 and 1 have a mean of \SI{23.8}{\ohm} with a standard deviation of \SI{0.26}{\ohm}.

It is worth noting that determining the values of $R_{htr}$ requires knowing the current through the heaters.
But because $R_{htr}$ is determined through the power dissipated in the resistor, an incorrect assumption about the current will lead to a an incorrect value of $R_{htr}$ which leaves $I_{htr}^2 R_{htr}$ unchanged.
So whenever the value $R_{htr}$ is used to calculated a power, the power value will be correct even in the face of an incorrect assumption about the current through the heater.

\begin{table*}[t]
\centering
\caption{Basic detector properties.
$P_{opt} = 150$~pW is assumed everywhere.
Uncertainties are 95 \% confidence intervals after marginalizing over other fit parameters, and do not include systematic uncertainties due to the unknown value of $P_{opt}$ or uncertainty in the value of the shunt resistors.
}
\label{tab:basic-det-props}
\begin{tabular}{l l l l l l}
\toprule
Detector &  $R_{htr}$ (\si{\ohm}) & $G$ (\si{\nano\W\per\K}) & $n$ & $T_c$ (mK) & $\tau$ (ms) \\
\RCm{29}{1} & 23.6 & 7.63 $\pm$ 0.08 & 3.52 $\pm$ 0.10 & 1209.4 $\pm$ 0.6 & 8.94 $\pm$ 0.1 \\
\RCm{30}{1} & 23.5 & 7.67 $\pm$ 0.07 & 3.54 $\pm$ 0.09 & 1213.9 $\pm$ 0.6 & 8.82 $\pm$ 0.2 \\
\RCm{31}{1} & 24.3 & 7.78 $\pm$ 0.09 & 3.64 $\pm$ 0.11 & 1214.7 $\pm$ 0.7 & 9.45 $\pm$ 0.1 \\
\RCm{32}{1} & 23.9 & 7.01 $\pm$ 0.43 & 3.18 $\pm$ 0.60 & 1211.6 $\pm$ 3.8 & 10.22 $\pm$ 0.1 \\
\RCm{29}{2} & 23.8 & 7.70 $\pm$ 0.09 & 3.62 $\pm$ 0.11 & 1213.7 $\pm$ 0.7 & 9.01 $\pm$ 0.1 \\
\RCm{31}{2} & 23.6 & 7.32 $\pm$ 0.16 & 3.45 $\pm$ 0.22 & 1211.3 $\pm$ 1.4 & 9.51 $\pm$ 0.1 \\
\RCm{32}{2} & 23.8 & 7.50 $\pm$ 0.27 & 3.74 $\pm$ 0.35 & 1215.6 $\pm$ 2.3 & 10.98 $\pm$ 0.1 \\
\midrule
Mean & 23.8 & 7.52 & 3.53 & 1212.9 & 9.56 \\
\bottomrule
\end{tabular}
\end{table*}

\section{Measurement of Natural Time Constant $\tau$} \label{sec:tau-nat}

%% run thesis/ana_tau_nat.m for results

The approach described in \sectionref{sec:tau-nat-theory} was used to measured the natural time constant tau.
The response to a step-function change in applied heater power was measured while the detectors were at $T_{bath} = \SI{1100}{\mK}$.
As described in \sectionref{sec:heater-r} the response to multiple steps was averaged together prior to making a fit.
For each bias point the measured time constant $\tau_{meas}$ and change in \TES\ current $\delta I$ was measured. A fit was then performed to \eqnref{eqn:teff-from-tau}:
\begin{equation} \label{eqn:tau-nat-fit}
  \tau_{meas} = \tau - \tau \mathcal{K} (I_{bias} \delta I).
\end{equation}
In this fit, $\tau_{meas}$ is considered the dependent variable, the product $(I_{bias} \delta I)$ is the independent variable, and both $\tau$ and $\mathcal{K}$ are fit for.

\figref{fig:tau-nat-plots} shows an example of fitting to \eqnref{eqn:tau-nat-fit}, and the measured values of $\tau$ are listed in \tableref{tab:basic-det-props}.

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-tau-nat-plots.pdf}
\caption{
  Plot showing example of fit to \eqnref{eqn:tau-nat-fit}, for \RCm{31}{1}.
} 
\label{fig:tau-nat-plots}
\end{figure*}

\section{Measurement of \TES\ $G$} \label{sec:g-psat}

With knowledge of the heater resistances, \IV\ curves can be taken over a wide range of bath temperatures, which enables a measurement of the \TES\ thermal conductance $G$.
Similarly to \sectionref{xxx}, I took \IV\ curves at bath temperatures ranging from 995~mK -- 1160~mK, while adjusting the applied heater power so that each \IV\ curve had a clear normal branch.
I again used the assumption that high in the transition the \TES\ resistance depends on only the \TES\ temperature, so that the Joule power $P_J$ dissipated in the \TES\ at $0.99R_n$ depends only on the bath temperature $T_b$ and the applied heater power $P_{htr} = I_{htr}^2 R_{htr}$. A fit can then be made to \eqnref{eqn:tes-ptot} in the form
\begin{equation}\label{eqn:g-fit}
P_{htr} + P_J + P_{opt}= \frac{G T_c}{n}\left(1 - \left(\frac{T_b}{T_c}\right)^n\right).
\end{equation}
The parameters to be fit to are $G$, $T_c$, and $n$.

A problem arises because the data described in this section were taken when the cryostat was open, so that $P_{opt}$ was non-zero, with an unknown value.
Because $P_{opt}$ is a simple additive constant, it is not possible to fit for this value unless another constraint (such as the value of $T_c$) is known.
However, the value of $P_{opt}$ can be estimated in two different ways. 
First, the predicted optical load of 165~pW from \sectionref{xxx} can be used.
Second, optical load on the prototype detectors was estimated to be in the range 135~pW--165~pW (xxx ref some section).
In this analysis I assume $P_{opt} = 150$~pW, while also showing how different assumptions change the values of  $G$, $T_c$, and $n$.

\tableref{tab:basic-det-props} lists the resulting values for $G$, $T_c$ and $n$.
\figref{fig:heater-g-plots} contains plots summarizing and explaining this data.
The uncertainties in $G$, $T_c$ and $n$ introduced by the unknown value of $P_{opt}$ are different.
$G$'s uncertainty from $P_{opt}$ is about the same size as the statistical uncertainty due to the fit, while $T_c$'s uncertainty from $P_{opt}$ is much larger than the statistical uncertainty.
Both of these uncertainties should be taken into account when predicting measurement of detector noise.
$n$ shows no apparent trend with $P_{opt}$.

\begin{figure*}
\includegraphics{drawings/ch8-g-plots.pdf}
\caption{Plots summarizing results of $G$, $T_c$ and $n$ measurements for seven detectors with good heaters.
All error bars and ellipses are 95 \% confidence intervals for statistical error; any systematic error is not included.
\textbf{Upper Left} Plot showing $P_{sat}$ vs $T_b$ for \RCm{31}{2}, assuming $P_{opt} = 150$~pW.
The red line shows the best fit to \eqnref{eqn:g-fit}.
The data covers 25 temperatures from 995~mK--1160~mK, and 11 different heater biases.
\textbf{Upper Right} Scatter plot showing correlation between $G$ and $n$, as well as error ellipses showing covariance between the estimated $G$ and $n$ vales.
\textbf{Lower Left} Plot showing variation of $G$ for \RCm{31}{2} vs assumed value of $P_{opt}$.
The statistical uncertainty in $G$ for this detector is approximately the same as the systematic uncertainty that results from the estimation of $P_{opt}$.
\textbf{Lower Right} Plot showing variation of $T_c$ for \RCm{31}{2} vs assumed value of $P_{opt}$.
In this case the systematic uncertainty is larger than the statistical uncertainty.
The value of $n$ shows no trend with $P_{opt}$.
} 
\label{fig:heater-g-plots}
\end{figure*}

As discussed in \sectionref{xxx}, the target $G$ value for these detectors was 3.7~nW/K.
The mean value for the seven measured detectors is 7.52~nW/K, 2.0 times larger than the target.
The reason for this discrepancy is not known.
%thz5 high g - 67 um 
%thz5 high g - 80 um 
%thz4 proto - 40 um

Prediction of detector G noise

xxx - need to account for correlation between G, n, Tc that arises from the fit.
Answer: there is a strong correlation between G and n, should plot these ellipses on G vs n plot. Also covariance with Tc, which you can account for in noise predictions, but makes little difference.

should at least look at all psat vs temp plots.

should work out $P_{sat}$ vs $T_b$ expansion to order $(\Delta T)^2$ - might help with above.

\section{Direct Measurement of Detector Responsivity and $\tau_{eff}$} \label{sec:teff-resp}

Knowledge of $R_{htr}$ allows a direct measurement of the DC responsivity of $\tau_{eff}$ for the seven detectors with heaters.
Steps in heater bias current were applied to these detectors while bias at typically operating conditions ($T_b = \SI{1100}{\mK}$, DAC$_{bias}$ = 27000).
The step size was made small so as the keep the detector response linear, and the response to many steps was averaged together to reduce noise.
The result was fit to an equation of the form
\begin{equation} \label{eqn:ch8-heater-step-trans}
  \delta I(t) = - \delta P_{htr} s_I(0) (1 - e^{-t/\tau_{eff}}),
\end{equation}
which is just \eqnref{eqn:htr-step-resp-high-time} with the \DC\ responsivity explicitly inserted.

\figref{fig:ch8-heater-step-trans} shows a sample fit to \eqnref{eqn:ch8-heater-step-trans}.
\tableref{tab:trans-det-props} lists the best-fit values of $s_I(0)$ and $\tau_{eff}$.

\begin{figure*}
\centering
\includegraphics{drawings/ch8-heater-step-trans.pdf}
\caption{Plot showing response of detector \RCm{30}{1} to step in applied heater power of \SI{1.41}{\pico\watt}.
Plots are for \RCm{30}{1} biased into normal operating conditions.
Data acquired at \SI{3125}{\Hz}.
Data averaged over 32 steps (16 up and 16 down) along with best fit to \eqnref{eqn:ch8-heater-step-trans}.
The step in applied power begins at $t \approx \SI{0.6}{\ms}$, not $t = \SI{0}{\ms}$.
} 
\label{fig:ch8-heater-step-trans}
\end{figure*}

\begin{table*}[t]
\centering
\caption{Detector Properties in Transition.
$P_{opt} = 150$~pW is assumed everywhere.
Uncertainties are 95 \% confidence intervals after marginalizing over other fit parameters, and do not include systematic uncertainties due to the unknown value of $P_{opt}$ or uncertainty in the value of the shunt resistors.
Values are for detectors biased at normal operating conditions of $T_b = \SI{1100}{\milli\kelvin}$ and detector bias of 27000.}
\label{tab:trans-det-props}
\begin{tabular}{l l l l l}
\toprule
Detector &  $s_I(0)$ (\si{\per\uV}) & $\tau_{eff}$ (\si{\ms}) \\
\midrule
\RCm{29}{1} & 0.612 & 3.17 \\
\RCm{30}{1} & 0.691 & 2.44 \\
\RCm{31}{1} & 0.605 & 3.25 \\
\RCm{32}{1} & 0.687 & 2.81 \\
\RCm{29}{2} & 0.663 & 2.83 \\
\RCm{31}{2} & 0.731 & 2.44 \\
\RCm{32}{2} & 0.681 & 3.24 \\
\bottomrule
\end{tabular}
\end{table*}


\section{Common Mode Signal and $1/f$ noise}

% thesis/ana_common_mode for all numbers

Our detectors have significant $1/f$ noise, with a \SI{3}{\decibel} knee of $\abt\SI{0.7}{\hertz}$.
Most of this noise is due to bath temperature fluctuations which are uncontrolled by the Cryocon \PID\ loop.
\figref{fig:ch8-cm-plots} contains several plots relating to this.
The upper left plot shows raw 10 minute detector timestreams for 15 detectors.
The common mode signal is evident in these plots, and is much stronger than the white noise at frequencies of \SI{1}{\Hz} and faster.
The upper right plot shows the same detector timestreams after removal of the mean of all ``good'' timestreams for columns 0 and 1 (the only columns which were biased for this test).
The large reduction of $1/f$ noise is evident in this plot.
The lower left plot shows direct evidence for this via the current noise power spectral density both before and after subtracting the common mode.
Also plotted is the power spectral density after subtracting the best-fit 4th order polynomial.
This does reduce noise at very low frequencies, but the effect is small.

The power spectral density plot has two important features.
First, a strong noise peak is located at \SI{1.411}{\Hz}.
This is caused by the \abt \SI{1.4}{\Hz} cycle of the \PTC; the physical mechanism could either by microphonic pickup of the vibrations caused by the \PTC\ cycle, or actual variation in bath temperature induced by the cycle.
This signal can be removed either through a common-mode subtraction scheme or a notch filter.
Second, the detector noise signal is completely unaffected by the common mode signal at frequencies faster than \SI{2}{\Hz}.
Because the frame rate of the video system is 6 FPS or faster, this indicated that the only impact of the strong common-mode noise signal on videos is the need to account for a time-varying detector offset.
Out approach to dealing with this offset is covered in \sectionref{xxx}.

The lower right plot in \figref{ch8-cm-plots} shows the detector timestream for \RCm{29}{1}, translated into variation in bath temperature.
We can define a differential thermal conductance relative to changes in bath temperature $G_b$ via
\begin{equation}
  G_b \equiv \frac{dP_b}{d T_nb} = G \left( \frac{T_b}{T} \right)^{n-1}.
\end{equation}
Then the equivalent bath temperature change for a given \TES\ current change will be given by
\begin{equation}
  \Delta T_b = \frac{\delta I}{s_I G_b}.
\end{equation}
For this temp the bath temperature was set to \SI{1100}{\mK}, so the temperature variations over several-minute timescales are a few parts in $10^{4}$.

\begin{figure*}
\includegraphics{drawings/ch8-cm-plots.pdf}
\caption{Plots summarizing common mode signal and $1/f$ noise.
\textbf{Upper Left}
Plow showing raw detector output for 15 detectors over a 10-minute data acquisition.
Only every 100th data point is plotted, which makes the white noise level appear somewhat smaller than it really is. 
\textbf{Upper Right} 
The same data after removal of the mean signal.
\textbf{Upper Left} 
Current noise power spectral density for the raw data, the raw data minus the common mode (``No CM''), the raw data minus the common mode and the best-fit 4th-order polynomial (``No CM, Poly''), and the common mode itself.
The strong noise peak at \SI{1.411}{\Hz} is due to the \PTC, as explained in the text.
\textbf{Lower Right} 
Raw datastream for \RCm{29}{1}, after conversion to a bath temperature variation, as described in the text.
}
\label{fig:ch8-cm-plots}
\end{figure*}

\section{Microphonic Pickup}

% Run thesis/ana_ptc for results

Some \TES\ detectors have been prone to microphonic pickup.
The earliest version of the cryostat used for this project used a Gifford-McMahon (\GM) cryocooler, which vibrates the cryostat significantly more than a \PTC\ does.
Prototype detectors had significantly higher noise levels with the \GM\ cooler running than when it was off; in addition the detector noise could be directly increased by striking the side of the cryostat with a soft mallet while the \GM\ cooler was turned off.
We interpreted this behavior as evidence for microphonic pickup, and as a result replaced the \GM\ cooler with a \PTC\ cooler.

To check whether microphonic pickup was present for the production detectors and the \PTC\ cooler, I took noise data both with the \PTC\ running and turned off.
In both cases the bath temperature was held steady at \SI{1100}{\mK} using the Cryocon temperature controller.
Common mode noise was removed and power spectra for each detector were calculated.
Then the excess noise for each detector was calculated as
\begin{equation}
  \sqrt{  \frac{ \sum_{f >= \SI{6}{\Hz}} S^2_{I,\textsc{ptc}}(f) }
               { \sum_{f >= \SI{6}{\Hz}} S^2_{I,\mbox{\tiny{No}}\textsc{ ptc}}(f) }},
\end{equation}
where $S^2_{I,\textsc{ptc}}$ and $S^2_{I,\mbox{\tiny{No}}\textsc{ ptc}}$ are the measured current noise power spectral densities with the \PTC\ turned on and off, expressed in units of \si{\A^2 \per \Hz}.

\figref{fig:ch8-ptc-plots} shows a histogram of this excess noise. Most detectors have higher noise with the \PTC\ on, but this excess noise is typically only a few percent. 
The mean excess noise is \SI{1}{\percent}.
The figure also contains a plot of the power spectral density for \RCm{29}{1} with the \PTC\ on and off.

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-ptc-plots.pdf}
\caption{%
\textbf{Top}
Histogram showing excess noise due to \PTC, defined as ratio of total noise above \SI{6}{\Hz} (see text for precise definition).
More detectors have higher noise with \PTC\ on than off, but the mean excess noise is only \SI{1}{\percent}.
\textbf{Bottom}
Current noise for \RCm{29}{1} with \PTC\ on and off, after subtracting common mode noise.
The noise below \SI{30}{\Hz} is 1.5--2.5 times higher with the \PTC\ on, but the total standard deviation of the relevant frequencies of $f >= \SI{6}{\Hz}$ is only \SI{2.9}{\percent}.
}
\label{fig:ch8-ptc-plots}
\end{figure*}

\section{Noise Aliasing}

As explained in \sectionref{xxx}, the \MCE\ takes data at \SI{15625}{\hertz}, but is only capable of sending data for the full array of 251~detectors to the readout computer at \SI{3125}{\hertz}.
This raises the question of how much noise is aliased from the \SIrange{3125}{15625}{\hertz} band to below \SI{3125}{\hertz}.
To check this I acquired data for the full array, under standard operating conditions, at the normal rate of \SI{3125}{\hertz} and for column 0 at \SI{15625}{\hertz}.
5 data files were acquired for each case. For each row in column 0 for each data file a power spectrum was taken after subtracting the common mode signal, and the excess noise was calculated as
\begin{equation}
  \sqrt{  \frac{ \sum S^2_{I,\SI{3125}{\Hz}}(f) \Delta f }
               { \sum S^2_{I,\SI{15625}{\Hz}}(f) \Delta f }},
\end{equation}
where $S^2_{I,\SI{3125}{\Hz}}$ and $S^2_{I,\SI{15625}{\Hz}}$ are the measured current noise power spectral densities at the two different multiplexing rates, averaged over all 5 data files, expressed in units of \si{\A^2 \per \Hz}.
The sums are performed only over those frequency components in the range \SIrange{6}{1562.5}{\Hz}, and note that $\Delta f$ is different for the two sampling rates.

\figref{fig:ch8-noise-aliasing} summarizes the results.
The average aliased noise is \SI{14}{\percent}, but some detectors have statistically significant higher levels of aliased noise; for example, \RCm{20}{1} has \SI{28}{\percent} excess noise.
Note that for some detectors the large error bars are due to changes over time of the noise level (for both rates of data acquisition).

The \MCE\ can be configured to apply a 4-pole digital lowpass filter to the the \SI{15625}{\Hz} data stream \cite{mce_team_digital_????}.
An appropriate choice of the cutoff frequency for this filter can greatly reduce aliased noise.
We have not yet implemented this filter, but plan to do for future operation of the system.

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-noise-aliasing.pdf}
\caption{%
\textbf{Top}
Plot showing fractional excess noise (see text for definition) due to noise aliasing for all rows of column 0.
The error bars are for \SI{95}{\percent} confidence intervals, and the average excess noise is \SI{14}{\percent}.
\textbf{Bottom}
Sample power spectra at \SI{3125}{\hertz} and \SI{15625}{\hertz} for \RCm{5}{1}.
For this detector the excess noise is \SI{17}{\percent}.
}
\label{fig:ch8-noise-aliasing}
\end{figure*}

\section{Bias Step Analysis: \Loop\ and $\beta_I$} \label{sec:bias-step}

As described in \sectionref{xxx}, steps in the applied bias current can be used to measure \Loop, $\beta_I$ and $R$ for a detector.
In order to make this measurement, the data acquisition rate must be fast enough to track the fast electrical response of the \TES.
In addition, the servo rolloff must be either fast enough to not affect the electrical response, or the effect of the servo rolloff must be included in the fit.

I took measurements at \SI{15625}{\hertz}, which is fast enough to track the electrical response.
I found that the servo rolloff too slow to be ignored, so the function to be fit to is \eqnref{xxx} after being passed through a single pole lowpass filter with time constant $\tau_{servo}$, so that $\tau_{servo}$ is one of the parameter to be fit.

\figref{fig:ch8-bias-step-plots} shows the result of these measurements being taken at a range of bias point for the four detectors on column 0 with good heaters.
The fits are generally good, but it is evident that at some bias points a damped oscillatory response is present on top of the expected \eqnref{xxx} response.
The source of this is not understood; one possible explanation would be the presence of a dangling heat capacity \cite{xxx}.

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-bias-step-plots.pdf}
\caption{%
  Plots summarizing bias step measurements.
\textbf{Left}
Response of \RCm{31}{1} to step in applied bias current, at a range of bias points. In all cases there is a fast increase in the \TES\ current followed by a slow decay to the final current, which for these bias points is always less than the initial current. As the detector is biased deeper into the transition the decrease in current becomes larger, indicating that loop gain increases deeper in the transition. 
\textbf{Upper Right}
Close-up view of initial stage of detector response.
Both the data and the best-fit curve to \eqnref{xxx} are shown, and the responses are offset vertically for clarity.
At some bias points a damped oscillatory response is present on top of the \eqnref{xxx} response; the source of this is not understood.
}
\label{fig:ch8-bias-step-plots}
\end{figure*}

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-bias-step-results.pdf}
\caption{%
  Plots showing results of fits for the four detectors tested at varying bias points in this section.
}
\label{fig:ch8-bias-step-results}
\end{figure*}

Once values for \Loop, $\beta_I$ and $R$ are known, the \DC\ responsivity $s_I(0)$ and $\tau_{eff}$ can be calculated from \eqnref{xxx} and \eqnref{xxx} respectively.
To check the accuracy of these calculations, I also measured the response of the detectors to steps in applied heater power at the same bias points for these four detectors.
The results of these measurements, as well the ratio of the predicted to measured values, are shown in \figref{fig:ch8-heater-step-pred-plots}.
The agreement between the predicted and measured values is good, indicating that response to detector bias steps can be used to predict $s_I(0)$ and $\tau_{eff}$ with good accuracy.
This is important because only a few detectors have working heaters, making direct measurements of responsivity impossible for most detectors.

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-heater-step-pred-plots.pdf}
\caption{%
  Plots showing measurements of detector response times $\tau_{eff}$ and responsivity $s_I(0)$ for the four detectors of column 0 with good heaters.
\textbf{Upper Left}
Measurements of $\tau_{eff}$ for a range of bias points.
\textbf{Upper Right}
Measurements of $s_I(0)$ for a range of bias points.
\textbf{Lower Left}
Comparison of predicted and measured $\tau_{eff}$ for the same detectors.
\textbf{Lower Right}
Comparison of predicted and measured $s_I(0)$ for the same detectors.
}
\label{fig:ch8-heater-step-pred-plots}
\end{figure*}

\figref{fig:ch8-all-loop-plots} summarizes measurements of \Loop, $\beta_I$, and $R$ for all working detectors

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-all-loop-plots.pdf}
\caption{
  Plots summarizing results of bias step measurements for all working detectors.
All data taken at normal operating conditions of $T_{bath} = \SI{1100}{\mK}$ and bias dac = 27000.
\textbf{Left Plots}
Histograms showing measured values of \Loop, $\beta_I$ and $R$.
\textbf{Right Plots}
Scatterplots showing how each of the three parameters \Loop, $\beta_I$ and $R$ correlate with each other.
Note that $R$ is plotting, the $R/R_n$. This is because $R_n$ is known only for those detectors on columns 0 and 1 with working heaters (see \sectionref{xxx}).
}
\label{fig:ch8-all-loop-plots}
\end{figure*}

\figref{fig:ch8-teff-si-pred} summarizes xxx

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-teff-si-pred.pdf}
\caption{
  Plots showing distribution of predicted $\tau_{eff}$ and $s_I(0)$. The predictions use the values for $R$, \Loop and $\beta_I$ shown in \figref{fig:ch8-all-loop-plots}, and $R_{sh}$ values from \sectionref{xxx}. $R_p$ is assumed to be zero in all cases.
xxx comment on whether getting below 2 ms is good enough
}
\label{fig:ch8-teff-si-pred}
\end{figure*}

\section{Detector Noise} \label{sec:det-noise}

While taking the measurements described in the previous section, I also took noise data for the four detectors with working heaters on column 0.
This data was taken at bias \DAC\ values of 25000, 26000, 27000, 28000, 29000, 30000, 31000 and 32000.
For each data acquisition the common mode signal was subtracted and the power spectra calculated using \MATLAB's \texttt{pwelch} function.
\figref{fig:ch8-trans-noise} shows the resulting power spectra, both in terms of the directly measured current noise $S^2_I$, as well as in terms of noise referred to power absorbed in the bolometer, $S^2_{P_{bolo}}$.
$S^2_{P_{bolo}}$ is calculated via
\begin{equation}
 S^2_{P_{bolo}} = S^2_I / s_I(0),
\end{equation}
where here the \DC\ detector responsivity $s_I(0)$ is calculated using the measurements described in \sectionref{xxx}.
Also plotted in the predicted detector noise level for each detector at each bias point, including the predicted photon noise level of \Pnoise{0.5e-15} from \sectionref{xxx}.

Several important features are visible in these plots.
First, \RCm{30}{1} shows several noise lines, the origin of which is not understood.
Second, for all four detectors the spread of noise levels in the \SIrange{1}{20}{\hertz} is much smaller when referred to power absorbed on the bolometer than in terms of current noise.
This is the expected behavior for a noise source that adds power directly to the bolometer, such as thermal fluctuation noise or photon noise, and is a result of changing detector responsivity with bias point.
Third, the shape of the noise curves are roughly as expected, with noise rolloffs happening at approximately the correct frequencies.
Fourth, the measured noise levels are much higher than the predicted noise levels.
\RCm{29}{1} is 2.4 times higher, \RCm{30}{1} is 7.4 times higher (dominated by the noise spikes), \RCm{31}{1} is 2.1 times higher and \RCm{32}{1} is 2.0 times higher.

The reason for this high level of noise is not known.
Two possible culprits are a higher than expected level of photon noise or a much larger value of $G$ than was measured.
Both of these possibilities would affect the noise spectrum in the same way, so they can not be distinguished.
\figref{fig:ch8-trans-noise-model-plots} plots the measured noise spectrum for \RCm{31}{1} at normal operating conditions, along with the basic model spectrum and a spectrum that includes enough additional ``power'' noise to match the measured whit noise level at low frequencies.
This could be due to a value of $G$ that in reality is 5.3 times higher than what was measured, or a photon noise level that is 3.2 times higher than predicted.

One problem with explaining the noise spectra this way is that the measured spectrum shows a shelf at \SIrange{100}{1000}{\hertz} which is not present in any of the models.
This shelf could possibly be explained by excess detector noise due to a dangling heat capacity \cite{xxx}, but this possibility has not been investigated.
A second problem is that it is difficult to understand how the measured value of $G$ could be so far off.
Excess photon noise seems a more likely explanation, and could be due to the optical load including \IR\ power leaking onto the detectors.
Even a small amount of \IR\ power can increase noise levels through the $\nu$ factor in \eqnref{eqn:photon-noise}.

Another possible explanation is a poor calibration of the readout system, so that the ``real'' current noise is \abt\ 2 times lower than measured.
However, this would reduce the measured values of $R_{sh}$ and $L_{ny}$ by a factor of $2^2=4$; as the design values for these were quite close to the measured values, and these design values have been confirmed by measurements for other interface chips \cite{appel pers comm}, this explanation is very unlikely. 

All this points to the conclusion that the high level of detector noise are real, but we do not yet have a full explanation for the high values.

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-trans-noise.pdf}
\caption{
Plots showing detector noise for the four detectors with working heaters on column 0.
The left column plots the directly measured current noise, after removing a common mode signal, at eight bias points from 25k to 32k.
The right column shows the same noise spectra, but referred to power absorbed in the bolometer.
For all four detectors, there is less spread in the low-frequency noise levels than in the current noise, suggesting that the dominant source of noise at these frequencies deposits power on the bolometers.
This behavior is expected of either thermal fluctuation noise or photon noise.
Also plotted in the right column is the predicted noise spectrum, using parameters taken from \sectionref{xxx}, included \Pnoise{0.5e-15} of photon noise.
For all four detectors, the measured noise is higher than predicted by the noise model.
}
\label{fig:ch8-trans-noise}
\end{figure*}

\begin{figure*}
  \centering
\includegraphics{drawings/ch8-trans-noise-model-plots.pdf}
\caption{
  Plot showing measured noise for \RCm{31}{1}, referred to power absorbed in bolometer, along with two noise models.
The red line is the basic detector noise model using measured values for all detector parameters as described in this chapter, including predicted \Pnoise{0.5e-15} of photon noise.
The black line is for a noise model that include enough excess ``power'' noise to match the measured white noise level at low frequencies.
This excess ``power'' noise could be due to a high level of photon noise (3.2 times higher than predicted) or a larger-than-measured value of $G$ (5.3 times higher than measured).
}
\label{fig:ch8-trans-noise-model-plotsn}
\end{figure*}
